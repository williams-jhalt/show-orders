{% extends 'base.html.twig' %}

{% block javascripts %}
    <script type="text/javascript">
        $(document).ready(function () {
            $('input[name="quantity"]').on('focus', function () {
                $(this).select();
            });
            $('.add-to-cart').on('submit', function () {
                console.log(this);
                var form = $(this);
                $.get(form.attr('action'), form.serialize(), function (data) {
                    form.html(data);
                });
                form.html("Loading...");
                return false;
            });
            $('.update-cart').on('submit', function () {
                console.log(this);
                var form = $(this);
                $.get(form.attr('action'), form.serialize(), function (data) {
                    form.html(data);
                });
                form.html("Loading...");
                return false;
            });
        });
    </script>
{% endblock %}

{% block body %}

    <h1>{{ vendor.company }}</h1>

    <div class="navbar navbar-default">
        <div class="container-fluid">
            <a class="btn btn-default navbar-btn {% if showAsList %}active{% endif %}" href="{{ path('vendor_order_sheet', {id: vendor.id, showAsList: true}) }}"><i class="glyphicon glyphicon glyphicon-th-list"></i></a>
            <a class="btn btn-default navbar-btn {% if not showAsList %}active{% endif %}" href="{{ path('vendor_order_sheet', {id: vendor.id, showAsList: false}) }}"><i class="glyphicon glyphicon glyphicon-th"></i></a>
        </div>
    </div>

    {% if showAsList %}

        <table class="table">
            <thead>
                <tr>
                    <th>Image</th>
                    <th>Item Number</th>
                    <th>Name</th>
                    <th>Price</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for item in vendor.products %}
                    <tr>
                        <td><img src="{{ image('uploads/products/' ~ item.imageUrl).resize(100,100) }}"></td>
                        <td style="vertical-align:middle;">{{ item.itemNumber }}</td>
                        <td style="vertical-align:middle;">{{ item.name }}</td>
                        <td style="vertical-align:middle;" class="text-right">${{ item.price|number_format(2) }}</td>
                        <td style="vertical-align:middle;">

                            {% if checkCart(item) %}
                                <form class="form-inline update-cart" action="{{ path('update_cart_inline', {id: item.id}) }}" method="get">
                                    <div class="form-group">
                                        <input class="form-control input-sm" type="number" name="quantity" value="{{ checkCart(item) }}">                                            
                                    </div>
                                    <button class="btn btn-sm btn-default" type="submit">Update</button>
                                </form>
                            {% else %}
                                <form class="form-inline add-to-cart" action="{{ path('add_to_cart', {id: item.id}) }}" method="get">       
                                    <div class="form-group">                             
                                        <input class="form-control input-sm" type="number" name="quantity" value="0">                                                     
                                    </div>                             
                                    <button class="btn btn-sm btn-default" type="submit">Add to Order</button>                                            
                                </form>
                            {% endif %}

                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

    {% else %}

        <div class="row">

            {% for item in vendor.products %}

                <div class="col-sm-4">
                    <div class="panel panel-default">

                        <div class="panel-heading" style="height:4em;overflow:hidden;">
                            {{ item.name }}
                        </div>

                        <div class="panel-body text-center">
                            <img src="{{ image('uploads/products/' ~ item.imageUrl).resize(200,200) }}">
                            <table class="table table-condensed">
                                <tr><th>Item Number</th><td>{{ item.itemNumber }}</td></tr>
                                <tr><th>Price</th><td>${{ item.price|number_format(2) }}</td></tr>
                            </table>
                        </div>

                        <div class="panel-footer text-center" style="min-height:4em;">
                            {% if checkCart(item) %}
                                <form class="form-inline update-cart" action="{{ path('update_cart_inline', {id: item.id}) }}" method="get">
                                    <div class="form-group">
                                        <input class="form-control input-sm" type="number" name="quantity" value="{{ checkCart(item) }}">                                      
                                    </div>
                                    <button class="btn btn-sm btn-default" type="submit">Update</button>
                                </form>
                            {% else %}
                                <form class="form-inline add-to-cart" action="{{ path('add_to_cart', {id: item.id}) }}" method="get">
                                    <div class="form-group">
                                        <input class="form-control input-sm" type="number" name="quantity" value="0">                                      
                                    </div>
                                    <button class="btn btn-sm btn-default" type="submit">Add to Order</button>
                                </form>
                            {% endif %}
                        </div>

                    </div>
                </div>

            {% endfor %}

        </div>

    {% endif %}

{% endblock %}
